============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.2, pluggy-1.6.0 -- C:\dev\projects\crypto-enhanced\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\dev\projects\crypto-enhanced
configfile: pytest.ini
testpaths: tests
plugins: asyncio-1.2.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 176 items

tests/test_api_authentication.py::test_api_secret_is_valid_base64 PASSED [  0%]
tests/test_api_authentication.py::test_api_secret_no_whitespace PASSED   [  1%]
tests/test_api_authentication.py::test_signature_generation PASSED       [  1%]
tests/test_api_authentication.py::test_kraken_client_initialization PASSED [  2%]
tests/test_api_authentication.py::test_kraken_client_sign_request PASSED [  2%]
tests/test_api_authentication.py::test_config_validation_catches_invalid_base64 PASSED [  3%]
tests/test_circuit_breaker.py::TestCircuitBreakerBasics::test_circuit_breaker_initialization PASSED [  3%]
tests/test_circuit_breaker.py::TestCircuitBreakerBasics::test_successful_call PASSED [  4%]
tests/test_circuit_breaker.py::TestCircuitBreakerBasics::test_failed_call_below_threshold PASSED [  5%]
tests/test_circuit_breaker.py::TestCircuitBreakerStateTransitions::test_open_after_threshold PASSED [  5%]
tests/test_circuit_breaker.py::TestCircuitBreakerStateTransitions::test_open_circuit_rejects_calls PASSED [  6%]
tests/test_circuit_breaker.py::TestCircuitBreakerStateTransitions::test_half_open_after_timeout PASSED [  6%]
tests/test_circuit_breaker.py::TestCircuitBreakerStateTransitions::test_half_open_requires_multiple_successes PASSED [  7%]
tests/test_circuit_breaker.py::TestCircuitBreakerStateTransitions::test_half_open_reopens_on_failure PASSED [  7%]
tests/test_circuit_breaker.py::TestCircuitBreakerReset::test_manual_reset PASSED [  8%]
tests/test_circuit_breaker.py::TestCircuitBreakerReset::test_success_resets_failures_in_closed PASSED [  9%]
tests/test_circuit_breaker.py::TestCircuitBreakerEdgeCases::test_concurrent_calls PASSED [  9%]
tests/test_circuit_breaker.py::TestCircuitBreakerEdgeCases::test_get_state_info PASSED [ 10%]
tests/test_circuit_breaker.py::TestCircuitBreakerEdgeCases::test_different_exception_types PASSED [ 10%]
tests/test_database.py::TestDatabase::test_database_initialization PASSED [ 11%]
tests/test_database.py::TestDatabase::test_database_context_manager PASSED [ 11%]
tests/test_database.py::TestDatabase::test_log_order PASSED              [ 12%]
tests/test_database.py::TestDatabase::test_log_trade PASSED              [ 13%]
tests/test_database.py::TestDatabase::test_log_position PASSED           [ 13%]
tests/test_database.py::TestDatabase::test_log_error PASSED              [ 14%]
tests/test_database.py::TestDatabase::test_log_performance PASSED        [ 14%]
tests/test_database.py::TestDatabase::test_get_recent_orders PASSED      [ 15%]
tests/test_database.py::TestDatabase::test_get_recent_trades PASSED      [ 15%]
tests/test_database.py::TestDatabase::test_database_reconnection PASSED  [ 16%]
tests/test_database.py::TestDatabase::test_concurrent_operations PASSED  [ 17%]
tests/test_database.py::TestDatabase::test_invalid_data_handling PASSED  [ 17%]
tests/test_database.py::TestDatabase::test_timestamp_normalization PASSED [ 18%]
tests/test_errors.py::TestTradingError::test_trading_error_creation FAILED [ 18%]
tests/test_errors.py::TestTradingError::test_trading_error_to_dict FAILED [ 19%]
tests/test_errors.py::TestAPIError::test_api_error_authentication FAILED [ 19%]
tests/test_errors.py::TestAPIError::test_api_error_rate_limit FAILED     [ 20%]
tests/test_errors.py::TestAPIError::test_api_error_network FAILED        [ 21%]
tests/test_errors.py::TestAPIError::test_api_error_validation FAILED     [ 21%]
tests/test_errors.py::TestAPIError::test_api_error_nonce FAILED          [ 22%]
tests/test_errors.py::TestWebSocketError::test_websocket_error_reconnectable FAILED [ 22%]
tests/test_errors.py::TestWebSocketError::test_websocket_error_not_reconnectable FAILED [ 23%]
tests/test_errors.py::TestOrderError::test_order_error_insufficient_funds FAILED [ 23%]
tests/test_errors.py::TestOrderError::test_order_error_market_closed FAILED [ 24%]
tests/test_errors.py::TestOrderError::test_order_error_temporary FAILED  [ 25%]
tests/test_errors.py::TestDatabaseError::test_database_error FAILED      [ 25%]
tests/test_errors.py::TestValidationError::test_validation_error FAILED  [ 26%]
tests/test_errors.py::TestErrorHandling::test_handle_error_trading_error FAILED [ 26%]
tests/test_errors.py::TestErrorHandling::test_handle_error_connection_error FAILED [ 27%]
tests/test_errors.py::TestErrorHandling::test_handle_error_generic FAILED [ 27%]
tests/test_errors.py::TestErrorHandling::test_classify_by_message_auth FAILED [ 28%]
tests/test_errors.py::TestErrorHandling::test_classify_by_message_rate_limit FAILED [ 28%]
tests/test_errors.py::TestErrorHandling::test_classify_by_message_network FAILED [ 29%]
tests/test_errors.py::TestErrorHandling::test_classify_by_message_validation FAILED [ 30%]
tests/test_errors.py::TestErrorHandling::test_classify_by_message_unknown FAILED [ 30%]
tests/test_kraken_client.py::TestKrakenClient::test_client_initialization PASSED [ 31%]
tests/test_kraken_client.py::TestKrakenClient::test_client_connection PASSED [ 31%]
tests/test_kraken_client.py::TestKrakenClient::test_nonce_generation PASSED [ 32%]
tests/test_kraken_client.py::TestKrakenClient::test_request_signing PASSED [ 32%]
tests/test_kraken_client.py::TestKrakenClient::test_public_request_success PASSED [ 33%]
tests/test_kraken_client.py::TestKrakenClient::test_private_request_success PASSED [ 34%]
tests/test_kraken_client.py::TestKrakenClient::test_kraken_api_error_handling PASSED [ 34%]
tests/test_kraken_client.py::TestKrakenClient::test_nonce_error_retry PASSED [ 35%]
tests/test_kraken_client.py::TestKrakenClient::test_network_error_retry PASSED [ 35%]
tests/test_kraken_client.py::TestKrakenClient::test_max_retry_exceeded PASSED [ 36%]
tests/test_kraken_client.py::TestKrakenClient::test_ticker_cache PASSED  [ 36%]
tests/test_kraken_client.py::TestKrakenClient::test_rate_limiting PASSED [ 37%]
tests/test_kraken_client.py::TestKrakenClient::test_place_order_validation PASSED [ 38%]
tests/test_kraken_client.py::TestKrakenClient::test_cancel_order PASSED  [ 38%]
tests/test_kraken_client.py::TestKrakenClient::test_error_helper_methods PASSED [ 39%]
tests/test_kraken_client.py::TestKrakenClient::test_context_manager PASSED [ 39%]
tests/test_kraken_client_coverage_gaps.py::TestCredentialValidation::test_logs_warning_when_credentials_invalid PASSED [ 40%]
tests/test_kraken_client_coverage_gaps.py::TestCredentialValidation::test_no_warning_when_credentials_valid PASSED [ 40%]
tests/test_kraken_client_coverage_gaps.py::TestCredentialValidation::test_skips_validation_when_prevention_unavailable PASSED [ 41%]
tests/test_kraken_client_coverage_gaps.py::TestBase64DecodingError::test_raises_api_error_on_invalid_base64_secret PASSED [ 42%]
tests/test_kraken_client_coverage_gaps.py::TestBase64DecodingError::test_base64_error_includes_underlying_exception PASSED [ 42%]
tests/test_kraken_client_coverage_gaps.py::TestBase64DecodingError::test_valid_base64_secret_works PASSED [ 43%]
tests/test_kraken_client_coverage_gaps.py::TestSecondaryKeyValidation::test_secondary_key_initialization PASSED [ 43%]
tests/test_kraken_integration.py::TestCircuitBreakerIntegration::test_circuit_breaker_initialized PASSED [ 44%]
tests/test_kraken_integration.py::TestCircuitBreakerIntegration::test_successful_api_call_keeps_circuit_closed PASSED [ 44%]
tests/test_kraken_integration.py::TestCircuitBreakerIntegration::test_repeated_failures_open_circuit PASSED [ 45%]
tests/test_kraken_integration.py::TestCircuitBreakerIntegration::test_circuit_recovery_after_timeout PASSED [ 46%]
tests/test_kraken_integration.py::TestCircuitBreakerIntegration::test_circuit_reopens_on_failure_in_half_open PASSED [ 46%]
tests/test_nonce_manager.py::TestNonceManager::test_nonce_generation PASSED [ 47%]
tests/test_nonce_manager.py::TestNonceManager::test_nonce_uniqueness PASSED [ 47%]
tests/test_nonce_manager.py::TestNonceManager::test_thread_safety PASSED [ 48%]
tests/test_nonce_manager.py::TestNonceManager::test_nonce_persistence FAILED [ 48%]
tests/test_nonce_manager.py::TestNonceManager::test_nonce_format PASSED  [ 49%]
tests/test_nonce_manager.py::TestNonceManager::test_microsecond_precision PASSED [ 50%]
tests/test_nonce_manager.py::TestNonceManager::test_concurrent_async_generation PASSED [ 50%]
tests/test_nonce_manager.py::TestNonceManager::test_recovery_from_future_nonce PASSED [ 51%]
tests/test_nonce_manager.py::TestNonceManager::test_high_frequency_generation PASSED [ 51%]
tests/test_nonce_manager.py::TestNonceManager::test_state_file_corruption_recovery FAILED [ 52%]
tests/test_nonce_manager.py::TestNonceManager::test_multiple_manager_instances PASSED [ 52%]
tests/test_nonce_manager.py::TestNonceManager::test_nonce_string_sorting PASSED [ 53%]
tests/test_nonce_manager.py::TestNonceManager::test_various_delays[0] PASSED [ 53%]
tests/test_nonce_manager.py::TestNonceManager::test_various_delays[1] PASSED [ 54%]
tests/test_nonce_manager.py::TestNonceManager::test_various_delays[10] PASSED [ 55%]
tests/test_nonce_manager.py::TestNonceManager::test_various_delays[100] PASSED [ 55%]
tests/test_strategies.py::TestRiskManager::test_approve_order_within_limits PASSED [ 56%]
tests/test_strategies.py::TestRiskManager::test_reject_order_exceeds_position_size PASSED [ 56%]
tests/test_strategies.py::TestRiskManager::test_reject_order_max_positions PASSED [ 57%]
tests/test_strategies.py::TestRiskManager::test_reject_order_exceeds_total_exposure PASSED [ 57%]
tests/test_strategies.py::TestRiskManager::test_calculate_metrics_empty PASSED [ 58%]
tests/test_strategies.py::TestRiskManager::test_calculate_metrics_with_positions PASSED [ 59%]
tests/test_strategies.py::TestTradingEngine::test_engine_initialization PASSED [ 59%]
tests/test_strategies.py::TestTradingEngine::test_initialize_strategies PASSED [ 60%]
tests/test_strategies.py::TestTradingEngine::test_calculate_order_cost_market_order PASSED [ 60%]
tests/test_strategies.py::TestTradingEngine::test_calculate_order_cost_limit_order PASSED [ 61%]
tests/test_strategies.py::TestTradingEngine::test_calculate_position_pnl_profit PASSED [ 61%]
tests/test_strategies.py::TestTradingEngine::test_calculate_position_pnl_loss PASSED [ 62%]
tests/test_strategies.py::TestTradingEngine::test_should_stop_loss_buy PASSED [ 63%]
tests/test_strategies.py::TestTradingEngine::test_should_stop_loss_sell PASSED [ 63%]
tests/test_strategies.py::TestTradingEngine::test_should_take_profit_buy PASSED [ 64%]
tests/test_strategies.py::TestTradingEngine::test_convert_pair_to_v2_format PASSED [ 64%]
tests/test_strategies.py::TestTradingEngine::test_on_ticker_update PASSED [ 65%]
tests/test_strategies.py::TestTradingEngine::test_on_balance_update PASSED [ 65%]
tests/test_strategies.py::TestTradingEngine::test_get_metrics PASSED     [ 66%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_calculation_with_known_values PASSED [ 67%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_calculation_downtrend PASSED [ 67%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_calculation_neutral PASSED [ 68%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_insufficient_data PASSED [ 68%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_all_gains_no_losses PASSED [ 69%]
tests/test_strategies_coverage.py::TestRSICalculation::test_rsi_all_losses_no_gains PASSED [ 69%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_oversold_condition_generates_buy_signal PASSED [ 70%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_overbought_condition_generates_sell_signal PASSED [ 71%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_neutral_rsi_generates_no_signal PASSED [ 71%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_overbought_no_positions_no_sell PASSED [ 72%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_oversold_below_price_range_no_buy PASSED [ 72%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_accumulation_limit_prevents_buy PASSED [ 73%]
tests/test_strategies_coverage.py::TestRSIMeanReversionSignals::test_insufficient_price_data_returns_none PASSED [ 73%]
tests/test_strategies_coverage.py::TestStrategyBase::test_get_current_price_from_last PASSED [ 74%]
tests/test_strategies_coverage.py::TestStrategyBase::test_get_current_price_from_close PASSED [ 75%]
tests/test_strategies_coverage.py::TestStrategyBase::test_get_current_price_no_data PASSED [ 75%]
tests/test_strategies_coverage.py::TestStrategyBase::test_can_trade_disabled_strategy PASSED [ 76%]
tests/test_strategies_coverage.py::TestStrategyBase::test_can_trade_daily_limit_reached PASSED [ 76%]
tests/test_strategies_coverage.py::TestStrategyBase::test_can_trade_within_cooldown PASSED [ 77%]
tests/test_strategies_coverage.py::TestStrategyBase::test_can_trade_after_cooldown PASSED [ 77%]
tests/test_strategies_coverage.py::TestStrategyBase::test_get_recent_prices_from_trades PASSED [ 78%]
tests/test_strategies_coverage.py::TestStrategyBase::test_get_recent_prices_fallback_to_ticker PASSED [ 78%]
tests/test_trading_engine.py::TestTradingEngine::test_engine_initialization PASSED [ 79%]
tests/test_trading_engine.py::TestTradingEngine::test_callback_registration PASSED [ 80%]
tests/test_trading_engine.py::TestTradingEngine::test_place_order PASSED [ 80%]
tests/test_trading_engine.py::TestTradingEngine::test_cancel_all_orders PASSED [ 81%]
tests/test_trading_engine.py::TestTradingEngine::test_close_position PASSED [ 81%]
tests/test_trading_engine.py::TestTradingEngine::test_risk_management PASSED [ 82%]
tests/test_trading_engine.py::TestTradingEngine::test_get_metrics PASSED [ 82%]
tests/test_trading_engine.py::TestTradingEngine::test_ticker_callback PASSED [ 83%]
tests/test_trading_engine.py::TestTradingEngine::test_execution_callback PASSED [ 84%]
tests/test_trading_engine.py::TestTradingEngine::test_balance_update_callback PASSED [ 84%]
tests/test_trading_engine.py::TestRiskManager::test_position_size_limit PASSED [ 85%]
tests/test_trading_engine.py::TestRiskManager::test_total_exposure_limit PASSED [ 85%]
tests/test_trading_engine.py::TestRiskManager::test_position_count_limit PASSED [ 86%]
tests/test_trading_engine.py::TestRiskManager::test_risk_score_calculation PASSED [ 86%]
tests/test_trading_engine.py::TestRiskManager::test_update_exposure PASSED [ 87%]
tests/test_websocket_connection.py::test_network_connectivity PASSED     [ 88%]
tests/test_websocket_connection.py::test_websocket_public PASSED         [ 88%]
tests/test_websocket_connection.py::test_websocket_private FAILED        [ 89%]
tests/test_websocket_manager.py::TestWebSocketManager::test_initialization PASSED [ 89%]
tests/test_websocket_manager.py::TestWebSocketManager::test_register_callback PASSED [ 90%]
tests/test_websocket_manager.py::TestWebSocketManager::test_connect_public_websocket PASSED [ 90%]
tests/test_websocket_manager.py::TestWebSocketManager::test_connect_private_websocket PASSED [ 91%]
tests/test_websocket_manager.py::TestWebSocketManager::test_subscribe_to_channels PASSED [ 92%]
tests/test_websocket_manager.py::TestWebSocketManager::test_handle_ticker_message PASSED [ 92%]
tests/test_websocket_manager.py::TestWebSocketManager::test_handle_trade_message PASSED [ 93%]
tests/test_websocket_manager.py::TestWebSocketManager::test_handle_execution_message PASSED [ 93%]
tests/test_websocket_manager.py::TestWebSocketManager::test_handle_balance_update PASSED [ 94%]
tests/test_websocket_manager.py::TestWebSocketManager::test_heartbeat_handling PASSED [ 94%]
tests/test_websocket_manager.py::TestWebSocketManager::test_error_message_handling PASSED [ 95%]
tests/test_websocket_manager.py::TestWebSocketManager::test_reconnection_on_disconnect PASSED [ 96%]
tests/test_websocket_manager.py::TestWebSocketManager::test_stop_websocket PASSED [ 96%]
tests/test_websocket_manager.py::TestWebSocketManager::test_is_connected PASSED [ 97%]
tests/test_websocket_manager.py::TestWebSocketManager::test_malformed_message_handling PASSED [ 97%]
tests/test_websocket_manager.py::TestWebSocketManager::test_concurrent_message_handling PASSED [ 98%]
tests/test_websocket_manager.py::TestWebSocketManager::test_subscription_confirmation PASSED [ 98%]
tests/test_websocket_manager.py::TestWebSocketManager::test_rate_limit_message PASSED [ 99%]
tests/test_websocket_manager.py::TestWebSocketManager::test_cleanup_on_exception PASSED [100%]

================================== FAILURES ===================================
________________ TestTradingError.test_trading_error_creation _________________
tests\test_errors.py:24: in test_trading_error_creation
    severity=ErrorSeverity.HIGH,
             ^^^^^^^^^^^^^
E   NameError: name 'ErrorSeverity' is not defined
_________________ TestTradingError.test_trading_error_to_dict _________________
tests\test_errors.py:41: in test_trading_error_to_dict
    severity=ErrorSeverity.LOW,
             ^^^^^^^^^^^^^
E   NameError: name 'ErrorSeverity' is not defined
_________________ TestAPIError.test_api_error_authentication __________________
tests\test_errors.py:58: in test_api_error_authentication
    error = APIError(
E   TypeError: APIError() takes no keyword arguments
___________________ TestAPIError.test_api_error_rate_limit ____________________
tests\test_errors.py:70: in test_api_error_rate_limit
    error = APIError(
E   TypeError: APIError() takes no keyword arguments
_____________________ TestAPIError.test_api_error_network _____________________
tests\test_errors.py:82: in test_api_error_network
    error = APIError(
E   TypeError: APIError() takes no keyword arguments
___________________ TestAPIError.test_api_error_validation ____________________
tests\test_errors.py:94: in test_api_error_validation
    error = APIError(
E   TypeError: APIError() takes no keyword arguments
______________________ TestAPIError.test_api_error_nonce ______________________
tests\test_errors.py:106: in test_api_error_nonce
    error = APIError(
E   TypeError: APIError() takes no keyword arguments
____________ TestWebSocketError.test_websocket_error_reconnectable ____________
tests\test_errors.py:121: in test_websocket_error_reconnectable
    error = WebSocketError(
E   TypeError: WebSocketError() takes no keyword arguments
__________ TestWebSocketError.test_websocket_error_not_reconnectable __________
tests\test_errors.py:133: in test_websocket_error_not_reconnectable
    error = WebSocketError(
E   TypeError: WebSocketError() takes no keyword arguments
_____________ TestOrderError.test_order_error_insufficient_funds ______________
tests\test_errors.py:149: in test_order_error_insufficient_funds
    error = OrderError(
E   TypeError: OrderError() takes no keyword arguments
________________ TestOrderError.test_order_error_market_closed ________________
tests\test_errors.py:161: in test_order_error_market_closed
    error = OrderError(
E   TypeError: OrderError() takes no keyword arguments
__________________ TestOrderError.test_order_error_temporary __________________
tests\test_errors.py:171: in test_order_error_temporary
    error = OrderError(
E   TypeError: OrderError() takes no keyword arguments
____________________ TestDatabaseError.test_database_error ____________________
tests\test_errors.py:185: in test_database_error
    error = DatabaseError(
            ^^^^^^^^^^^^^
E   NameError: name 'DatabaseError' is not defined
__________________ TestValidationError.test_validation_error __________________
tests\test_errors.py:203: in test_validation_error
    error = ValidationError(
            ^^^^^^^^^^^^^^^
E   NameError: name 'ValidationError' is not defined
______________ TestErrorHandling.test_handle_error_trading_error ______________
tests\test_errors.py:221: in test_handle_error_trading_error
    original = TradingError("Test", severity=ErrorSeverity.LOW)
                                             ^^^^^^^^^^^^^
E   NameError: name 'ErrorSeverity' is not defined
____________ TestErrorHandling.test_handle_error_connection_error _____________
tests\test_errors.py:229: in test_handle_error_connection_error
    handled = handle_error(original, "api_call")
              ^^^^^^^^^^^^
E   NameError: name 'handle_error' is not defined
_________________ TestErrorHandling.test_handle_error_generic _________________
tests\test_errors.py:238: in test_handle_error_generic
    handled = handle_error(original, "unknown_operation")
              ^^^^^^^^^^^^
E   NameError: name 'handle_error' is not defined
_______________ TestErrorHandling.test_classify_by_message_auth _______________
tests\test_errors.py:245: in test_classify_by_message_auth
    error = classify_by_message("Authentication failed", "login")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'classify_by_message' is not defined
____________ TestErrorHandling.test_classify_by_message_rate_limit ____________
tests\test_errors.py:253: in test_classify_by_message_rate_limit
    error = classify_by_message("Too many requests", "ticker")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'classify_by_message' is not defined
_____________ TestErrorHandling.test_classify_by_message_network ______________
tests\test_errors.py:261: in test_classify_by_message_network
    error = classify_by_message("Connection timeout", "websocket")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'classify_by_message' is not defined
____________ TestErrorHandling.test_classify_by_message_validation ____________
tests\test_errors.py:269: in test_classify_by_message_validation
    error = classify_by_message("Invalid parameter value", "order")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'classify_by_message' is not defined
_____________ TestErrorHandling.test_classify_by_message_unknown ______________
tests\test_errors.py:276: in test_classify_by_message_unknown
    error = classify_by_message("Random error message", "test")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'classify_by_message' is not defined
___________________ TestNonceManager.test_nonce_persistence ___________________
tests\test_nonce_manager.py:82: in test_nonce_persistence
    manager1 = NonceManager(state_file=temp_nonce_file)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: NonceManager.__init__() got an unexpected keyword argument 'state_file'
____________ TestNonceManager.test_state_file_corruption_recovery _____________
tests\test_nonce_manager.py:193: in test_state_file_corruption_recovery
    manager = NonceManager(state_file=temp_nonce_file)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: NonceManager.__init__() got an unexpected keyword argument 'state_file'
___________________________ test_websocket_private ____________________________
tests\test_websocket_connection.py:159: in test_websocket_private
    await kraken_client.close()
          ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'KrakenClient' object has no attribute 'close'
------------------------------ Captured log call ------------------------------
ERROR    websocket_manager:websocket_manager.py:524 Error processing balances message: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\dev\projects\crypto-enhanced\websocket_manager.py", line 519, in _process_message
    await self._handle_balance(data)
  File "C:\dev\projects\crypto-enhanced\websocket_manager.py", line 567, in _handle_balance
    await self.callbacks['balance'](data)
TypeError: object NoneType can't be used in 'await' expression
ERROR    websocket_manager:websocket_manager.py:524 Error processing executions message: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\dev\projects\crypto-enhanced\websocket_manager.py", line 517, in _process_message
    await self._handle_execution(data)
  File "C:\dev\projects\crypto-enhanced\websocket_manager.py", line 561, in _handle_execution
    await self.callbacks['execution'](data)
TypeError: object NoneType can't be used in 'await' expression
=========================== short test summary info ===========================
FAILED tests/test_errors.py::TestTradingError::test_trading_error_creation - ...
FAILED tests/test_errors.py::TestTradingError::test_trading_error_to_dict - N...
FAILED tests/test_errors.py::TestAPIError::test_api_error_authentication - Ty...
FAILED tests/test_errors.py::TestAPIError::test_api_error_rate_limit - TypeEr...
FAILED tests/test_errors.py::TestAPIError::test_api_error_network - TypeError...Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002329CAB2350>

FAILED tests/test_errors.py::TestAPIError::test_api_error_validation - TypeEr...
FAILED tests/test_errors.py::TestAPIError::test_api_error_nonce - TypeError: ...
FAILED tests/test_errors.py::TestWebSocketError::test_websocket_error_reconnectable
FAILED tests/test_errors.py::TestWebSocketError::test_websocket_error_not_reconnectable
FAILED tests/test_errors.py::TestOrderError::test_order_error_insufficient_funds
FAILED tests/test_errors.py::TestOrderError::test_order_error_market_closed
FAILED tests/test_errors.py::TestOrderError::test_order_error_temporary - Typ...
FAILED tests/test_errors.py::TestDatabaseError::test_database_error - NameErr...
FAILED tests/test_errors.py::TestValidationError::test_validation_error - Nam...
FAILED tests/test_errors.py::TestErrorHandling::test_handle_error_trading_error
FAILED tests/test_errors.py::TestErrorHandling::test_handle_error_connection_error
FAILED tests/test_errors.py::TestErrorHandling::test_handle_error_generic - N...
FAILED tests/test_errors.py::TestErrorHandling::test_classify_by_message_auth
FAILED tests/test_errors.py::TestErrorHandling::test_classify_by_message_rate_limit
FAILED tests/test_errors.py::TestErrorHandling::test_classify_by_message_network
FAILED tests/test_errors.py::TestErrorHandling::test_classify_by_message_validation
FAILED tests/test_errors.py::TestErrorHandling::test_classify_by_message_unknown
FAILED tests/test_nonce_manager.py::TestNonceManager::test_nonce_persistence
FAILED tests/test_nonce_manager.py::TestNonceManager::test_state_file_corruption_recovery
FAILED tests/test_websocket_connection.py::test_websocket_private - Attribute...
================= 25 failed, 151 passed in 211.84s (0:03:31) ==================
